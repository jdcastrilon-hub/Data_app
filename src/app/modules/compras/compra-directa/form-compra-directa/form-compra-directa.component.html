<form [formGroup]="formulario">
    <mat-card appearance="raised">
        <mat-card-header class="mat-header">
            <mat-card-title>COMPRA DIRECTA</mat-card-title>
        </mat-card-header>
        <div style="height: 1px; background-color: rgb(201, 199, 199); margin: 1px 0;"></div>
        <mat-tab-group animationDuration="0ms" mat-stretch-tabs="false" mat-align-tabs="start">

            <mat-tab label="Datos Generales" style="background-color: brown;">

                <div class="bloque">

                    <div fxLayout="row" fxLayoutAlign="space-between stretch" fxLayoutGap="5px">
                        <div fxFlex="15">
                            <mat-form-field class="form-field-compacto mat-form-field" appearance="outline">
                                <mat-label>Numero O.C</mat-label>
                                <input matInput formControlName="nroDocum">
                                <mat-error>Codigo requerido</mat-error>
                            </mat-form-field>
                        </div>
                        <div fxFlex="15">
                            <mat-form-field class="form-field-compacto form-field-date" appearance="outline">
                                <mat-label>Fecha Compra</mat-label>
                                <input matInput [matDatepicker]="picker" placeholder="dd/mm/yyyy"
                                    formControlName="fecDoc">
                                <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                                <mat-datepicker #picker></mat-datepicker>
                            </mat-form-field>
                        </div>
                        <div fxFlex="40">
                            <mat-form-field class="form-field-compacto mat-form-field" appearance="outline">
                                <mat-label>Proveedor</mat-label>
                                <input matInput>
                                <mat-error>Codigo requerido</mat-error>
                            </mat-form-field>
                        </div>
                        <div fxFlex="15">
                            <section class="example-section">
                                <mat-checkbox formControlName="ingresaBodega" color="primary">
                                    Recepciona
                                </mat-checkbox>
                            </section>
                        </div>
                        <div fxFlex="15">
                            <mat-form-field class="form-field-compacto mat-form-field" appearance="outline">
                                <mat-label>Status</mat-label>
                                <mat-select [formControl]="SelecStatusControl" required>
                                    @for (obj_tipo of list_status; track obj_tipo) {
                                    <mat-option [value]="obj_tipo">{{obj_tipo}}</mat-option>
                                    }
                                </mat-select>
                                @if (SelecStatusControl.hasError('required')) {
                                <mat-error>Debe seleccionar una opcion</mat-error>
                                }
                            </mat-form-field>
                        </div>
                    </div>
                </div>

                <div style="height: 1px; background-color: rgb(201, 199, 199); margin: 1px 0;"></div>

                <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 tabla-compacta"
                    formArrayName="detalles">
                    <ng-container matColumnDef="id">
                        <mat-header-cell *matHeaderCellDef> Art√≠culo </mat-header-cell>
                        <mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <articulo-autocomplet formControlName="search"
                                (articuloSeleccionado)="onArticuloChange($event, i)"></articulo-autocomplet>

                        </mat-cell>
                    </ng-container>
                    <ng-container matColumnDef="costo">
                        <th mat-header-cell *matHeaderCellDef>Costo</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <input matInput formControlName="cantidad" placeholder="Nombre" />
                            <mat-error *ngIf="row.get('cantidad')?.hasError('required')">
                                La cantidad es obligatoria.
                            </mat-error>
                            <mat-error *ngIf="row.get('cantidad')?.hasError('min')">
                                La cantidad debe ser mayor a 0.
                            </mat-error>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="cantidad">
                        <th mat-header-cell *matHeaderCellDef>Cantidad</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <input matInput formControlName="cantidad" placeholder="Nombre" />
                            <mat-error *ngIf="row.get('cantidad')?.hasError('required')">
                                La cantidad es obligatoria.
                            </mat-error>
                            <mat-error *ngIf="row.get('cantidad')?.hasError('min')">
                                La cantidad debe ser mayor a 0.
                            </mat-error>
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="neto">
                        <th mat-header-cell *matHeaderCellDef>Neto</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <span>
                                {{ row.get('nombreArticulo')?.value }}
                            </span>
                            <input type="hidden" formControlName="nombreArticulo">
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="name">
                        <th mat-header-cell *matHeaderCellDef>Nombre</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <span>
                                {{ row.get('nombreArticulo')?.value }}
                            </span>
                            <input type="hidden" formControlName="nombreArticulo">
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="ubicacion">
                        <th mat-header-cell *matHeaderCellDef>Ubicacion</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <span>
                                {{ row.get('idUbicacion')?.value }}
                            </span>
                            <input type="hidden" formControlName="idUbicacion">
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="Lote">
                        <th mat-header-cell *matHeaderCellDef>Lote</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <span>
                                {{ row.get('idLote')?.value }}
                            </span>
                            <input type="hidden" formControlName="idLote">
                        </td>
                    </ng-container>
                    <ng-container matColumnDef="stock">
                        <th mat-header-cell *matHeaderCellDef>Stock</th>
                        <td mat-cell *matCellDef="let row; let i = index" [formGroupName]="i">
                            <span>
                                {{ row.get('cantDisp')?.value }}
                            </span>
                            <input type="hidden" formControlName="cantDisp">
                        </td>
                    </ng-container>

                    <ng-container matColumnDef="actions">
                        <th mat-header-cell *matHeaderCellDef> Acciones </th>
                        <td mat-cell *matCellDef="let row; let i = index">
                            <button mat-icon-button color="primary" type="button">

                            </button>

                        </td>
                    </ng-container>
                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                </table>

            </mat-tab>

            <mat-tab label="Facturacion" style="background-color: brown;">

            </mat-tab>

            <mat-tab label="Bodega" style="background-color: brown;">

            </mat-tab>

        </mat-tab-group>
        <br>

        <mat-card-actions class="mat-accion-botones">
            <button mat-raised-button color="primary" type="submit">Guardar</button>
            <br>
            <button mat-raised-button color="warn" type="button">Salir</button>
        </mat-card-actions>

    </mat-card>

</form>